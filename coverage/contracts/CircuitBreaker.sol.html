<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\CircuitBreaker.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> CircuitBreaker.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/41</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/26</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/80</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.22;
&nbsp;
import "./interfaces/ICircuitBreaker.sol";
import "@openzeppelin/contracts-upgradeable/access/AccessControlUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/utils/PausableUpgradeable.sol";
&nbsp;
/**
 * @title CircuitBreaker
 * @dev Advanced circuit breaker implementation with anomaly detection
 * @notice This contract monitors transfer patterns and can trigger circuit breakers
 */
contract CircuitBreaker is ICircuitBreaker, AccessControlUpgradeable, PausableUpgradeable {
    
    // ============ Constants ============
    
    bytes32 public constant CIRCUIT_BREAKER_ROLE = keccak256("CIRCUIT_BREAKER_ROLE");
    
    // ============ State Variables ============
    
    bool public isCircuitBreakerActive;
    string public activationReason;
    uint256 public activationTime;
    
    // Volume-based circuit breaker
    uint256 public maxDailyVolume;
    uint256 public maxHourlyVolume;
    uint256 public maxSingleTransfer;
    
    // Velocity-based circuit breaker
    uint256 public maxTransfersPerHour;
    uint256 public maxTransfersPerDay;
    
    // Anomaly detection
    uint256 public maxFailedAttempts;
    uint256 public failedAttemptWindow;
    
    // Time-based auto-reset
    uint256 public autoResetInterval;
    uint256 public lastResetTime;
    
    // Tracking variables
    mapping(uint256 =&gt; uint256) public dailyVolume;
    mapping(uint256 =&gt; uint256) public hourlyVolume;
    mapping(uint256 =&gt; uint256) public hourlyTransferCount;
    mapping(uint256 =&gt; uint256) public dailyTransferCount;
    mapping(address =&gt; uint256) public failedAttempts;
    mapping(address =&gt; uint256) public lastFailedAttempt;
    
    // ============ Events ============
    
    event CircuitBreakerActivated(string reason, uint256 timestamp);
    event CircuitBreakerDeactivated(uint256 timestamp);
    event VolumeLimitExceededEvent(uint256 limit, uint256 actual, string period);
    event VelocityLimitExceededEvent(uint256 limit, uint256 actual, string period);
    event FailedAttemptsExceededEvent(address account, uint256 attempts);
    event AutoResetTriggered(uint256 timestamp);
    
    // ============ Errors ============
    
    error CircuitBreakerActive();
    error VolumeLimitExceeded();
    error VelocityLimitExceeded();
    error FailedAttemptsExceeded();
    error InvalidParameters();
    error UnauthorizedCaller();
    
    // ============ Initialization ============
    
<span class="fstat-no" title="function not covered" >    function initialize(</span>
        address admin,
        uint256 _maxDailyVolume,
        uint256 _maxHourlyVolume,
        uint256 _maxSingleTransfer,
        uint256 _maxTransfersPerHour,
        uint256 _maxTransfersPerDay,
        uint256 _maxFailedAttempts,
        uint256 _failedAttemptWindow,
        uint256 _autoResetInterval
    ) public initializer {
<span class="cstat-no" title="statement not covered" >        __AccessControl_init()</span>;
<span class="cstat-no" title="statement not covered" >        __Pausable_init()</span>;
        
<span class="cstat-no" title="statement not covered" >        _grantRole(DEFAULT_ADMIN_ROLE, admin)</span>;
<span class="cstat-no" title="statement not covered" >        _grantRole(CIRCUIT_BREAKER_ROLE, admin)</span>;
        
        maxDailyVolume = _maxDailyVolume;
        maxHourlyVolume = _maxHourlyVolume;
        maxSingleTransfer = _maxSingleTransfer;
        maxTransfersPerHour = _maxTransfersPerHour;
        maxTransfersPerDay = _maxTransfersPerDay;
        maxFailedAttempts = _maxFailedAttempts;
        failedAttemptWindow = _failedAttemptWindow;
        autoResetInterval = _autoResetInterval;
        
        lastResetTime = block.timestamp;
    }
    
    // ============ Circuit Breaker Logic ============
    
    
    /**
     * @notice Record a successful transfer
     */
<span class="fstat-no" title="function not covered" >    function recordTransfer(address from, address /* to */, uint256 amount) external {</span>
<span class="cstat-no" title="statement not covered" >        uint256 currentDay = block.timestamp / 1 days;</span>
<span class="cstat-no" title="statement not covered" >        uint256 currentHour = block.timestamp / 1 hours;</span>
        
        dailyVolume[currentDay] += amount;
        hourlyVolume[currentHour] += amount;
        hourlyTransferCount[currentHour]++;
        dailyTransferCount[currentDay]++;
        
        // Reset failed attempts on successful transfer
        failedAttempts[from] = 0;
    }
    
    /**
     * @notice Record a failed transfer attempt
     */
<span class="fstat-no" title="function not covered" >    function recordFailedAttempt(address account) external {</span>
<span class="cstat-no" title="statement not covered" >        if (block.timestamp - lastFailedAttempt[account] &gt;= failedAttemptWindow) {</span>
            failedAttempts[account] = 1;
        } else {
            failedAttempts[account]++;
        }
        
        lastFailedAttempt[account] = block.timestamp;
        
<span class="cstat-no" title="statement not covered" >        if (failedAttempts[account] &gt;= maxFailedAttempts) {</span>
<span class="cstat-no" title="statement not covered" >            _activateCircuitBreaker("Failed attempts exceeded")</span>;
<span class="cstat-no" title="statement not covered" >            emit FailedAttemptsExceededEvent(account, failedAttempts[account]);</span>
        }
    }
    
    /**
     * @notice Activate circuit breaker
     */
<span class="fstat-no" title="function not covered" >    function activateCircuitBreaker(string calldata reason) external onlyRole(CIRCUIT_BREAKER_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        _activateCircuitBreaker(reason)</span>;
    }
    
    /**
     * @notice Deactivate circuit breaker
     */
<span class="fstat-no" title="function not covered" >    function deactivateCircuitBreaker() external onlyRole(CIRCUIT_BREAKER_ROLE) {</span>
        isCircuitBreakerActive = false;
        activationReason = "";
        activationTime = 0;
<span class="cstat-no" title="statement not covered" >        emit CircuitBreakerDeactivated(block.timestamp);</span>
    }
    
    /**
     * @notice Auto-reset circuit breaker if interval has passed
     */
<span class="fstat-no" title="function not covered" >    function autoReset() external {</span>
<span class="cstat-no" title="statement not covered" >        if (block.timestamp &gt;= lastResetTime + autoResetInterval) {</span>
            isCircuitBreakerActive = false;
            activationReason = "";
            activationTime = 0;
            lastResetTime = block.timestamp;
            
            // Reset tracking variables
<span class="cstat-no" title="statement not covered" >            uint256 currentDay = block.timestamp / 1 days;</span>
<span class="cstat-no" title="statement not covered" >            uint256 currentHour = block.timestamp / 1 hours;</span>
            
            dailyVolume[currentDay] = 0;
            hourlyVolume[currentHour] = 0;
            hourlyTransferCount[currentHour] = 0;
            dailyTransferCount[currentDay] = 0;
            
<span class="cstat-no" title="statement not covered" >            emit AutoResetTriggered(block.timestamp);</span>
        }
    }
    
    // ============ Internal Functions ============
    
<span class="fstat-no" title="function not covered" >    function _activateCircuitBreaker(string memory reason) internal {</span>
        isCircuitBreakerActive = true;
        activationReason = reason;
        activationTime = block.timestamp;
<span class="cstat-no" title="statement not covered" >        emit CircuitBreakerActivated(reason, block.timestamp);</span>
    }
    
    // ============ Interface Functions ============
    
    /**
     * @notice Check if a transfer should be allowed based on circuit breaker rules
     * @param amount The amount of tokens to transfer
     */
<span class="fstat-no" title="function not covered" >    function checkTransfer(address /* from */, address /* to */, uint256 amount) external view override {</span>
<span class="cstat-no" title="statement not covered" >        if (isCircuitBreakerActive) {</span>
<span class="cstat-no" title="statement not covered" >            revert("Circuit breaker is active")</span>;
        }
        
        // Check single transfer limit
<span class="cstat-no" title="statement not covered" >        if (amount &gt; maxSingleTransfer) {</span>
<span class="cstat-no" title="statement not covered" >            revert("Transfer amount exceeds single transfer limit")</span>;
        }
        
<span class="cstat-no" title="statement not covered" >        uint256 currentDay = block.timestamp / 1 days;</span>
<span class="cstat-no" title="statement not covered" >        uint256 currentHour = block.timestamp / 1 hours;</span>
        
        // Check daily volume limit
<span class="cstat-no" title="statement not covered" >        if (dailyVolume[currentDay] + amount &gt; maxDailyVolume) {</span>
<span class="cstat-no" title="statement not covered" >            revert("Transfer would exceed daily volume limit")</span>;
        }
        
        // Check hourly volume limit
<span class="cstat-no" title="statement not covered" >        if (hourlyVolume[currentHour] + amount &gt; maxHourlyVolume) {</span>
<span class="cstat-no" title="statement not covered" >            revert("Transfer would exceed hourly volume limit")</span>;
        }
        
        // Check daily transfer count limit
<span class="cstat-no" title="statement not covered" >        if (dailyTransferCount[currentDay] &gt;= maxTransfersPerDay) {</span>
<span class="cstat-no" title="statement not covered" >            revert("Daily transfer count limit exceeded")</span>;
        }
        
        // Check hourly transfer count limit
<span class="cstat-no" title="statement not covered" >        if (hourlyTransferCount[currentHour] &gt;= maxTransfersPerHour) {</span>
<span class="cstat-no" title="statement not covered" >            revert("Hourly transfer count limit exceeded")</span>;
        }
    }
    
<span class="fstat-no" title="function not covered" >    function isActive() external view override returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >        return isCircuitBreakerActive;</span>
    }
    
<span class="fstat-no" title="function not covered" >    function getActivationReason() external view override returns (string memory) {</span>
<span class="cstat-no" title="statement not covered" >        return activationReason;</span>
    }
    
<span class="fstat-no" title="function not covered" >    function getCurrentDailyVolume() external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 currentDay = block.timestamp / 1 days;</span>
<span class="cstat-no" title="statement not covered" >        return dailyVolume[currentDay];</span>
    }
    
<span class="fstat-no" title="function not covered" >    function getCurrentHourlyVolume() external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 currentHour = block.timestamp / 1 hours;</span>
<span class="cstat-no" title="statement not covered" >        return hourlyVolume[currentHour];</span>
    }
    
<span class="fstat-no" title="function not covered" >    function getCurrentHourlyTransferCount() external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 currentHour = block.timestamp / 1 hours;</span>
<span class="cstat-no" title="statement not covered" >        return hourlyTransferCount[currentHour];</span>
    }
    
<span class="fstat-no" title="function not covered" >    function getCurrentDailyTransferCount() external view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 currentDay = block.timestamp / 1 days;</span>
<span class="cstat-no" title="statement not covered" >        return dailyTransferCount[currentDay];</span>
    }
    
    // ============ Admin Functions ============
    
<span class="fstat-no" title="function not covered" >    function updateLimits(</span>
        uint256 _maxDailyVolume,
        uint256 _maxHourlyVolume,
        uint256 _maxSingleTransfer,
        uint256 _maxTransfersPerHour,
        uint256 _maxTransfersPerDay,
        uint256 _maxFailedAttempts,
        uint256 _failedAttemptWindow,
        uint256 _autoResetInterval
    ) external onlyRole(DEFAULT_ADMIN_ROLE) {
        maxDailyVolume = _maxDailyVolume;
        maxHourlyVolume = _maxHourlyVolume;
        maxSingleTransfer = _maxSingleTransfer;
        maxTransfersPerHour = _maxTransfersPerHour;
        maxTransfersPerDay = _maxTransfersPerDay;
        maxFailedAttempts = _maxFailedAttempts;
        failedAttemptWindow = _failedAttemptWindow;
        autoResetInterval = _autoResetInterval;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Oct 06 2025 03:02:49 GMT+1000 (Vladivostok Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
